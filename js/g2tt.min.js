function refreshCats(){var e=new Object;e.op="getCounters",e.output_mode="fc";var t=apiCall(e);t.done(function(e){for(var t=e.content,i=[],n=[],s=0;s<t.length;s++)"cat"==t[s].kind?i[t[s].id]=t[s]:n[t[s].id]=t[s];$(".sub-row").each(function(e,t){var s=$(this).attr("id").substring(10),a=$(this).hasClass("open-sub-folder")||$(this).hasClass("closed-sub-folder");"-4"==s||"-1"==s?($(this).find(".item-count-value").html(n["global-unread"].counter),"0"==n["global-unread"].counter?($(this).addClass("no-unread-sub-row").removeClass("unread-sub"),$("#subscriptions").removeClass("show-unread").addClass("show-all")):($(this).removeClass("no-unread-sub-row").addClass("unread-sub"),"unread"==pref_ViewMode&&$("#subscriptions").hasClass("show-all")&&$("#subscriptions").removeClass("show-all").addClass("show-unread"))):a?($(this).find(".item-count-value").html(i[s].counter),"0"==i[s].counter?$(this).addClass("no-unread-sub-row").removeClass("unread-sub"):$(this).removeClass("no-unread-sub-row").addClass("unread-sub")):($(this).find(".item-count-value").html(n[s].counter),"0"==n[s].counter?$(this).addClass("no-unread-sub-row").removeClass("unread-sub"):$(this).removeClass("no-unread-sub-row").addClass("unread-sub"))}),showEmpty(),$("#header-refresh").removeClass("m-button-pressed")})}function showEmpty(){var e=$("#sub-"+global_parentId).children(":visible");0==e.length&&$("#subscriptions").removeClass("show-unread").addClass("show-all")}function showFeeds(){$("#feed").addClass("hidden"),$("#subscriptions").removeClass("hidden"),$(".back-to-feeds").addClass("hidden"),$(".articlesMenu").addClass("hidden"),$(".feedsMenu").removeClass("hidden"),$("#add-new-subscription").removeClass("hidden"),"-4"!=global_parentId&&($("#sub-list-back").removeClass("hidden"),$("#add-new-subscription").addClass("hidden")),$("#nav-title").html("")}function showArticles(){$("#feed").removeClass("hidden"),$("#subscriptions").addClass("hidden"),$("#add-new-subscription").addClass("hidden"),$(".back-to-feeds").removeClass("hidden"),$(".articlesMenu").removeClass("hidden"),$(".feedsMenu").addClass("hidden"),$("#sub-list-back").addClass("hidden")}function apiCall(e,t){void 0===t&&(t=!0),e.sid=$.cookie("g2tt_sid"),e=JSON.stringify(e);var i=$.ajax({url:global_ttrssUrl+"/api/",type:"post",dataType:"json",data:e,asynch:t});return i}function getHeadlines(e){$("body").addClass("loading"),$(".load-more-message").html("Loading..."),$(".entries-count").html(""),void 0===e&&(e=0);var t=$("#search-input").val(),i=new Object;i.op="getHeadlines",i.feed_id=pref_Feed,i.limit=pref_Feed_limit,i.show_excerpt=1,i.show_content=1,i.include_attachments=0,i.view_mode=pref_ViewMode,i.is_cat=pref_IsCat,i.include_nested=!0,i.order_by=pref_OrderBy,"date_reverse"==pref_OrderBy?i.since_id=e:i.skip=e,i.search=t;var n=apiCall(i);n.done(function(e,t,s){if(0!=e.status)return $.removeCookie("g2tt_sid"),void getData();n=e.content,n.length!=i.limit?$("#load-more-items").hide():$("#load-more-items").show(),$.each(n,function(e,t){global_ids.push(t.id);var i=t.title,n='<br><h4>Sent to you via tt-rss</h4><h2><a href="'+t.link+'">'+t.title+"</a></h2>"+t.content,s=$(t.content),a=null;if(1==s.length&&s.is("img")&&(a=s.attr("title")||s.attr("alt")))s=$("<div>"+s[0].outerHTML+"<div>"+a+"</div></div>");else{var d=$("<div></div>");d.append(s),s=d}var o=new Date(1e3*t.updated),r="<div id='"+t.id+"' class='entry-row whisper"+(t.unread?"":" read")+"'>             <div class='entry-container'>             <div class='entry-top-bar'>             <span class='link entry-next'>             <span class='entry-next-fa-icon'><i class='fa fa-arrow-down'></i></span>             <span class='entry-next-text'>Next item</span>             </span>             <span class='link entry-collapse'>             <span class='entry-collapse-fa-icon'><i class='fa fa-bars'></i></span>             <span class='entry-collapse-text'>Collapse</span>             </span>             </div>             <div class='entry-header'> \t\t<div class='entry-icons'> \t\t\t<i class='favStarDiv fa fa-star-o fa-2x starBorder "+(t.marked?"starActive":"starNotActive")+"'> </i> \t\t\t<i class='favStar fa fa-star fa-2x "+(t.marked?"starActive":"starNotActive")+"'></i> \t\t</div>             <div class='entry-header-body'>             <div class='text'>             <span class='item-title-collapsed'>"+t.title+"</span>             <a href='"+t.link+"'             class='item-title item-title-link' target='_blank'>"+t.title+"</a>             <span class='item-source-title'>&nbsp;-&nbsp;"+t.feed_title+"</span>             <div class='item-snippet'>"+(t.excerpt&&"&hellip;"!=t.excerpt?t.excerpt:$(t.content).text().substr(0,100)+"&hellip;")+"</div>             </div>             <div class='entry-sub-header'>by "+t.author+" on "+o.toLocaleString()+"</div>             <i class='readability fa fa-indent' data-href='"+t.link+"'></i>             </div>             </div>             <div class='entry'>             <i class='totop fa fa-angle-double-up'></i>             <div id='entry-contents' class='entry whisper'>             <div class='entry-annotations'></div>             <div class='entry-contents-inner'>"+s[0].outerHTML+"</div>             </div>             <div class='entry-footer'>             <div class='entry-actions'>             <div class='entry-actions-primary'>             <i class='fa fa-book read-state link unselectable' title='Toggle read'>&nbsp;Mark unread</i>             <span class='link unselectable' title='Sent by mail'>             <i class='fa fa-envelope-o' style='vertical-align:top;'></i>             <a class='link unselectable' href='mailto:?subject="+encodeURIComponent(i)+"&body="+encodeURIComponent(n)+"'>E-Mail</a>             </span>             <wbr />             </div>             </div>             </div>             <div class='action-area-container'></div>             </div>             </div>             </div>";$("#entries").append(r)}),$(".entry-header-body").unbind("click").click(function(){expandEntry($(this).closest(".entry-row"))}),$(".entry-top-bar").unbind("click").click(function(){collapseEntry($(this).closest(".entry-row"))}),$(".entry-next").unbind("click").click(function(e){expandEntry($(this).closest(".entry-row").next()),e.stopPropagation()}),$(".totop").unbind("click").click(function(){$("html,body").animate({scrollTop:$(this).parent().siblings(".entry-top-bar").offset().top},"fast")}),$("i.readability").unbind("click").click(function(){url="noticia original"==$(this).parents(".entry-header").siblings(".entry").find(".entry-contents-inner a").last().text()?$(this).parents(".entry-header").siblings(".entry").find(".entry-contents-inner a").last().attr("href"):$(this).data("href"),window.open("https://aibe.pro/g2ttrss/read.php?r="+encodeURIComponent(url),"_blank")}),$(window).on("scroll",function(){$(".expanded").length&&$(this).scrollTop()>$(".expanded").offset().top-$(window).height()/2-$(".entry-top-bar").height()&&$(this).scrollTop()<$(".expanded").offset().top+$(".expanded").innerHeight()-$(window).height()/2-$(".entry-top-bar").height()&&$(".expanded .totop").hasClass("visible")?$(".expanded .totop").fadeIn(50):$(".expanded .totop").fadeOut(50)}),$(".read-state").unbind("click").click(function(){toggleEntryAsRead($(this).closest(".entry-row"))}),$(".favStarDiv").unbind("click").click(function(){var e=new Object;e.op="updateArticle",e.article_ids=$(this).closest(".entry-row").attr("id"),e.mode=2,e.field=0;apiCall(e);$(this).next().toggleClass("starNotActive").toggleClass("starActive")}),$("body").removeClass("loading").addClass("loaded"),$(".load-more-message").html("Mark these items as read"),$(".entries-count").html("Showing "+$(".entry-row").length+" items"),keepUnread.clean(global_ids)})}function getTopCategories(){if($("#nav-title").html(""),$("#sub-list-back").addClass("hidden"),0!=$("#sub--4").length)$("#subscriptions-list").children().addClass("hidden"),$("#sub--4").removeClass("hidden"),$(".closed-sub-folder").unbind("click").click(function(){global_backCat.push("-4"),$("#subscriptions-list").children().addClass("hidden"),getFeeds($(this).attr("id").substring(10),$(this).find(".sub-item").html(),$(this).find(".item-count-value").html())});else{$("body").addClass("loading").addClass("sub-tree"),$("#loading-area-container").removeClass("hidden"),$("#subscriptions-list").append("<div id='sub--4'></div>");var e=new Object;e.op="getUnread";var t=apiCall(e);t.done(function(e,t,i){unread=e.content.unread;var n="<div class='row whisper sub-row open-sub-folder"+(unread>0?" unread-sub":" no-unread-sub-row")+"' id='tree-item--4'>         <div class='icon-cell'>         <i class='fa fa-folder-open fa-lg'></i> </div>         <div class='text sub-item'>All articles</div>         <div class='item-count larger whisper'>         <span class='item-count-value' id='tree-item--4-unread-count'>"+unread+"</span>         </div>         </div>";$("#sub--4").prepend(n),$("#tree-item--4").unbind("click").click(function(){$.cookie("g2tt_feed",$(this).attr("id").substring(10)),$.cookie("g2tt_isCat",!1),pref_Feed=$.cookie("g2tt_feed"),pref_IsCat=$.cookie("g2tt_isCat"),getData()})});e=new Object;e.op="getCategories",e.enable_nested=!0;var i=apiCall(e);i.done(function(e,t,n){i=e.content,i.sort(function(e,t){var i=e.order_id<t.order_id?-1:e.order_id>t.order_id?1:0,n=e.title<t.title?-1:e.title>t.title?1:0;return"1"==pref_FeedSort?n:i}),$.each(i,function(e,t){var i="<div class='row whisper sub-row closed-sub-folder"+(t.unread>0?" unread-sub":" no-unread-sub-row")+" nested-sub' id='tree-item-"+t.id+"'>         <div class='icon-cell'>         <i class='fa fa-folder fa-lg'></i></div>         <div class='text sub-item'>"+t.title+"</div>         <div class='item-count larger whisper'>         <span class='item-count-value' id='tree-item-"+t.id+"-unread-count'>"+t.unread+"</span>         </div>         </div>";$("#sub--4").append(i)}),$(".closed-sub-folder").unbind("click").click(function(){global_backCat.push("-4"),$("#subscriptions-list").children().addClass("hidden"),getFeeds($(this).attr("id").substring(10),$(this).find(".sub-item").html(),$(this).find(".item-count-value").html())}),$("body").removeClass("loading").addClass("loaded"),$("#loading-area-container").addClass("hidden")})}}function getFeeds(e,t,i){if(global_parentId=e,"-4"!==e)if($("#nav-title").html(""),$("#sub-list-back").removeClass("hidden"),$("#add-new-subscription").addClass("hidden"),0!=$("#sub-"+e).length)$("#subscriptions-list").children().addClass("hidden"),$("#sub-"+e).removeClass("hidden"),$(".closed-sub-folder").unbind("click").click(function(){global_backCat.push(e),$("#subscriptions-list").children().addClass("hidden"),getFeeds($(this).attr("id").substring(10),$(this).find(".sub-item").html(),$(this).find(".item-count-value").html())});else{$("body").addClass("loading").addClass("sub-tree"),$("#loading-area-container").removeClass("hidden");var n=new Object;n.op="getFeeds",n.cat_id=e,n.include_nested=!0;var s=apiCall(n);s.done(function(n,a,d){s=n.content,s.sort(function(e,t){var i=e.title<t.title?-1:e.title>t.title?1:0;return"1"==pref_FeedSort?i:e.cat_id<t.cat_id?-1:e.cat_id>t.cat_id?1:0}),$("#subscriptions-list").append("<div id='sub-"+e+"'></div>");var o="<div class='row whisper sub-row open-sub-folder"+(i>0?" unread-sub":" no-unread-sub-row")+"' id='tree-item-"+e+"'>         <div class='icon-cell'>         <i class='fa fa-folder-open fa-lg'></i> </div>         <div class='text sub-item'>"+t+"</div>         <div class='item-count larger whisper'>         <span class='item-count-value' id='tree-item-"+e+"-unread-count'>"+i+"</span>         </div>         </div>";$("#sub-"+e).prepend(o),$.each(s,function(t,i){var n="<div class='row whisper sub-row"+(i.unread>0?" unread-sub":" no-unread-sub-row")+(i.is_cat?" closed-sub-folder":" sub")+" nested-sub' id='tree-item-"+i.id+"'>         <div class='icon-cell'>         <i class='fa fa-rss-square'></i> </div>         <div class='text sub-item'>"+i.title+"</div>         <div class='item-count larger whisper'>         <span class='item-count-value' id='tree-item-"+i.id+"-unread-count'>"+i.unread+"</span>         </div>         </div>";$("#sub-"+e).append(n)}),$(".closed-sub-folder").unbind("click").click(function(){global_backCat.push(e),$("#subscriptions-list").children().addClass("hidden"),getFeeds($(this).attr("id").substring(10),$(this).find(".sub-item").html(),$(this).find(".item-count-value").html())}),$('.open-sub-folder[id!="tree-item--4"]').unbind("click").click(function(){$.cookie("g2tt_feed",$(this).attr("id").substring(10)),$.cookie("g2tt_isCat",!0),pref_Feed=$.cookie("g2tt_feed"),pref_IsCat=$.cookie("g2tt_isCat"),getData()}),$(".sub").unbind("click").click(function(){$.cookie("g2tt_feed",$(this).attr("id").substring(10)),$.cookie("g2tt_isCat",!1),pref_Feed=$.cookie("g2tt_feed"),pref_IsCat=$.cookie("g2tt_isCat"),getData()}),$("body").removeClass("loading").addClass("loaded"),$("#loading-area-container").addClass("hidden")})}else getTopCategories()}function getTitle(){var e=new Object;"true"==pref_IsCat?e.op="getCategories":(e.op="getFeeds",e.cat_id="-4");var t=apiCall(e);t.done(function(e,t,i){if(0!=e.status)return $.removeCookie("g2tt_sid"),void getData();items=e.content,$.each(items,function(e,t){t.id!=pref_Feed||$("#nav-title").html(t.title)})})}function load(){void 0===$.cookie("g2tt_sid")?($("#main").addClass("hidden"),$(".login").removeClass("hidden")):"1"==pref_StartInCat?(showFeeds(),getTopCategories()):(getTitle(),getHeadlines(),getTopCategories())}function getData(){showArticles(),$("body").removeClass("loaded").addClass("loading"),$(".load-more-message").html("Marking as read..."),$("#entries").empty(),global_ids=[],getTitle(),getHeadlines()}function subscribe(e,t){var i=new Object;i.op="subscribeToFeed",i.feed_url=e,i.category_id=t,$("#indicator").removeClass("hidden");var n=apiCall(i);n.done(function(e,t,i){e.content,e.content.status.message,e.content.status;var n=e.content.status.code,s=e.content.status.feeds,a=[],d=[];for(var o in s)s.hasOwnProperty(o)&&(a.push(o),d.push(s[o]));switch(n){case 0:$("#indicator").addClass("hidden"),window.alert("Feed already exists in your feed list.");break;case 1:$("#indicator").addClass("hidden");var r=$(".validateTips");r.text("Your Feed was Added").addClass("ui-state-highlight").removeClass("hidden"),$("#multipleFeedNotice").addClass("hidden"),$("#multipleFeedsSelect").addClass("hidden"),setTimeout(function(){$("#feedURL").val("")},100);break;case 2:$("#indicator").addClass("hidden"),$("#multipleFeedNotice").addClass("hidden"),$("#multipleFeedsSelect").addClass("hidden"),window.alert("Invalid URL submitted. Please check URL and try again.");break;case 3:$("#indicator").addClass("hidden"),$("#multipleFeedNotice").addClass("hidden"),$("#multipleFeedsSelect").addClass("hidden"),window.alert("URL content is HTML, no feeds available. Please check that URL has feeds and try again.");break;case 4:$("#indicator").addClass("hidden"),$("#multipleFeedNotice").removeClass("hidden"),$("#multipleFeedsSelect").removeClass("hidden"),console.log(s),$.each(s,function(e,t){$("#feedsAvail").append($("<option></option>").val(e).html(t))}),console.log("Populate Multiple FeedsNew");break;case 5:$("#indicator").addClass("hidden"),$("#multipleFeedNotice").addClass("hidden"),$("#multipleFeedsSelect").addClass("hidden"),window.alert("Unable to download the URL content. Please check your internet connection or the URL and try again.");break;case 6:$("#indicator").addClass("hidden"),$("#multipleFeedNotice").addClass("hidden"),$("#multipleFeedsSelect").addClass("hidden"),window.alert("Content is an invalid XML format. Please visit the website you are trying to add to verify they use XML feed output.")}return e})}function unSubscribe(e,t,i){var n="",s={op:"unsubscribeFeed",sid:t,feed_id:i};return $.ajax({type:"POST",url:e+"/api/",contentType:"application/json",data:JSON.stringify(s),dataType:"json",async:!1,success:function(e){n=e.content.status},error:function(){showAlert("Network Error, Please Check Network","ttRss")}}),n}function getCategoriesForNewSubscribe(){var e=new Object;e.op="getFeedTree",e.include_empty=!0,e.enable_nested=!1;var t=apiCall(e);t.done(function(e,i,n){t=e.content,$("#catItems").find("option").remove(),$("#catItems").append($("<option></option>").val(0).html("Uncategorized")),$.each(t,function(e,t){$.each(t.items,function(e,t){var i=[];-1!=t.bare_id&&0!=t.bare_id&&i.push({parent_id:t.bare_id,child_id:t.bare_id,Name:t.name}),$.each(t.items,function(e,n){"category"==n.type&&i.push({parent_id:t.bare_id,child_id:n.bare_id,Name:n.name})}),$.each(i,function(e,t){if($.each(t,function(e,t,i){}),t.parent_id==t.child_id)$("#catItems").append($("<option></option>").val(t.parent_id).html(t.Name));else $("#catItems").append($("<option></option>").val(t.child_id).html("&lfloor; "+t.Name))})})})})}function expandEntry(e){if(!e.hasClass("expanded")&&($(".totop").fadeOut("fast"),$(".expanded").slideUp("fast",function(){$("html,body").animate({scrollTop:e.offset().top},"fast")}).removeClass("expanded"),e.addClass("expanded"),$(".current-entry").removeClass("current-entry"),e.addClass("current-entry"),e.find("#entry-contents").parent().css({width:$(window).width()-15}),e.find("#entry-contents").parent().slideDown(100,function(){$("html,body").animate({scrollTop:e.offset().top},"fast"),setTimeout(function(){let t=e.height()>$(window).height()?$(window).height()/2:0;0<t&&($(".totop").css({top:t}),$(".totop").addClass("visible"))},600)}),e.find("#entry-contents").css({width:$(window).width()-20}),e.find("#entry-contents").slideDown(700),!e.hasClass("read"))){e.addClass("read");var t=new Object;t.op="updateArticle",t.article_ids=e.attr("id"),t.mode=0,t.field=2;apiCall(t)}}function collapseEntry(e){$(".totop").fadeOut("fast",function(){e.find(".entry").slideUp(500),e.removeClass("expanded")})}function toggleEntryAsExpanded(e){e.hasClass("expanded")?collapseEntry(e):expandEntry(e)}function toggleCurrentEntryAsExpanded(e){$(".current-entry").length&&toggleEntryAsExpanded($(".current-entry"))}function expandNextEntry(){$(".current-entry").length?$nextEntry=$(".current-entry").next():$nextEntry=$(".entry-row").eq(0),$nextEntry.is(".entry-row")&&expandEntry($nextEntry)}function expandPreviousEntry(){$(".current-entry").length&&($previous=$(".current-entry").prev(),$previous.is(".entry-row")&&expandEntry($previous))}function jumpNextEntry(){$(".current-entry").length?$nextEntry=$(".current-entry").next():$nextEntry=$(".entry-row").eq(0),$nextEntry.is(".entry-row")&&($(".current-entry").removeClass("current-entry"),$nextEntry.addClass("current-entry"),isElementInViewport($(".current-entry"))||$(".current-entry")[0].scrollIntoView(!1))}function jumpPreviousEntry(){$(".current-entry").length&&($previous=$(".current-entry").prev(),$previous.is(".entry-row")&&($(".current-entry").removeClass("current-entry"),$previous.addClass("current-entry"),isElementInViewport($(".current-entry"))||$(".current-entry")[0].scrollIntoView()))}function toggleEntryAsRead(e){if(e.toggleClass("read"),e.hasClass("read")){e.find(".read-state").html("&nbsp;Mark unread");i=e.attr("id");global_ids.push(i),keepUnread.removeId(i)}else{e.find(".read-state").html("&nbsp;Mark read");for(var t=0;t<global_ids.length;t++){var i=e.attr("id");global_ids[t]==i&&(global_ids.splice(t,1),keepUnread.addId(i))}}var n=new Object;n.op="updateArticle",n.article_ids=e.attr("id"),n.mode=2,n.field=2;apiCall(n)}function toggleCurrentEntryAsRead(e){$(".current-entry").length&&toggleEntryAsRead($(".current-entry"))}function isElementInViewport(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}pref_IsCat=!1,void 0!==$.cookie("g2tt_feed")&&(pref_Feed=$.cookie("g2tt_feed")),void 0!==$.cookie("g2tt_isCat")&&(pref_IsCat=$.cookie("g2tt_isCat")),void 0!==$.cookie("g2tt_viewMode")&&(pref_ViewMode=$.cookie("g2tt_viewMode")),void 0!==$.cookie("g2tt_orderBy")&&(pref_OrderBy=$.cookie("g2tt_orderBy")),void 0!==$.cookie("g2tt_feedSort")&&(pref_FeedSort=$.cookie("g2tt_feedSort")),global_backCat=[],global_ids=[],global_parentId="-4",$(document).ready(function(){function e(e){d.text(e).addClass("ui-state-highlight").removeClass("hidden"),setTimeout(function(){d.removeClass("ui-state-highlight",1500)},500)}function t(t,i,n,s){return!(t.val().length>s||t.val().length<n)||(t.addClass("ui-state-error"),e("Length of "+i+" must be between "+n+" and "+s+"."),!1)}function i(e){return e.substr(0,5).toLowerCase()+e.substr(5)}function n(t,n,s){var a=t.val().trim();return console.log(i(a)),!!n.test(i(a))||(t.addClass("ui-state-error"),e(s),!1)}$("html").unbind("click").click(function(){$("#header-menu").removeClass("m-button-pressed"),$("#menuDown").removeClass("hidden"),$("#menuUp").addClass("hidden"),$(".g2tt-menu").hide()}),$("#login").submit(function(e){a&&a.abort();var t=$(this),i=t.find("input"),n={};i.each(function(){n[this.name]=$(this).val()});var s={op:"login",user:n.Username,password:n.Passwd};i.prop("disabled",!0);var a=apiCall(s);a.done(function(e,t,i){"LOGIN_ERROR"==e.content.error&&window.alert("Username and/or Password were incorrect!"),"API_DISABLED"==e.content.error?window.alert("The API Setting is disabled. Login on the desktop version and enable API in the Preferences."):($.cookie("g2tt_sid",e.content.session_id,{expires:7}),$(".login").addClass("hidden"),$("#main").removeClass("hidden"),load())}),a.fail(function(e,t,i){console.error("The following error occured: "+t,i)}),a.always(function(){i.prop("disabled",!1)}),e.preventDefault()}),$("#load-more-items").unbind("click").click(function(){if("date_reverse"==pref_OrderBy)var e=$(".entry-row").last().attr("id");else e=$(".entry-row").length;getHeadlines(e)}),$("#header-menu").unbind("click").click(function(e){$(this).toggleClass("m-button-pressed"),$("#menuDown").toggleClass("hidden"),$("#menuUp").toggleClass("hidden"),$(".g2tt-menu").css({top:parseInt($(".nav-bar-container").height())-8+"px"}),$(".g2tt-menu").toggle(),e.stopPropagation()}),$("#header-refresh").unbind("click").click(function(){$(this).addClass("m-button-pressed"),$("#subscriptions").is(":hidden")?location.reload(!0):refreshCats()}),$("#"+pref_ViewMode).addClass("g2tt-option-selected"),$(".showItem").unbind("click").click(function(){pref_ViewMode=$(this).attr("id"),$.cookie("g2tt_viewMode",pref_ViewMode),$(".showItem").removeClass("g2tt-option-selected"),$(this).addClass("g2tt-option-selected"),$(".feedsItem").removeClass("g2tt-option-selected"),$("#feeds-"+pref_ViewMode).addClass("g2tt-option-selected"),$("#entries").empty(),$("#subscriptions").attr("class","hidden show-"+pref_ViewMode),getHeadlines()}),$("#"+pref_OrderBy).addClass("g2tt-option-selected"),$(".sortItem").unbind("click").click(function(){pref_OrderBy=$(this).attr("id"),$.cookie("g2tt_orderBy",pref_OrderBy),$(".sortItem").removeClass("g2tt-option-selected"),$(this).addClass("g2tt-option-selected"),$("#entries").empty(),getHeadlines()}),$(".back-to-feeds").unbind("click").click(function(){refreshCats(),showFeeds()}),$("#add-new-subscription").unbind("click").click(function(){$("#dialog-form").dialog("open"),getCategoriesForNewSubscribe()}),$("#feeds-"+pref_ViewMode).addClass("g2tt-option-selected"),$("#subscriptions").addClass("show-"+pref_ViewMode),$(".feedsItem").unbind("click").click(function(){pref_ViewMode=$(this).attr("id").substring(6),$.cookie("g2tt_viewMode",pref_ViewMode),$(".feedsItem").removeClass("g2tt-option-selected"),$(this).addClass("g2tt-option-selected"),$(".showItem").removeClass("g2tt-option-selected"),$("#"+pref_ViewMode).addClass("g2tt-option-selected"),$("#subscriptions").attr("class","show-"+$(this).attr("id").substring(6))}),"1"==pref_FeedSort&&$(".feedsSort").addClass("g2tt-option-selected"),$(".feedsSort").unbind("click").click(function(){"1"==pref_FeedSort?pref_FeedSort="0":pref_FeedSort="1",$.cookie("g2tt_feedSort",pref_FeedSort),$(this).toggle("g2tt-option-selected")}),$("#sub-list-back").unbind("click").click(function(){refreshCats(),getFeeds(global_backCat.pop()),$("#add-new-subscription").removeClass("hidden")}),$("#show-more-row, #menu-mark-read").unbind("click").click(function(){$("body").removeClass("loaded").addClass("loading"),$(".load-more-message").html("Marking as read..."),keepUnread.removeFromArray(global_ids);var e=new Object;e.op="updateArticle",e.article_ids=global_ids.join(","),e.mode=0,e.field=2;var t=apiCall(e);t.done(function(e){$("#entries").empty(),getHeadlines(),$("html, body").animate({scrollTop:0})})}),$("#menu-logout").unbind("click").click(function(){var e=new Object;e.op="logout";var t=apiCall(e);t.done(function(e){$.removeCookie("g2tt_feed"),$.removeCookie("g2tt_isCat"),$.removeCookie("g2tt_viewMode"),$.removeCookie("g2tt_orderBy"),$.removeCookie("g2tt_sid"),location.reload(!0)})}),$("#menu-search").unbind("click").click(function(){$(".search-box").removeClass("hidden"),$("#search-input").focus()}),$("#search-cancel").unbind("click").click(function(){$("#search-input").val(""),$(".search-box").addClass("hidden")}),$("#search-input").keypress(function(e){if(13==e.which)return jQuery(this).blur(),jQuery("#search-submit").focus().click(),!1}),$("#search-submit").unbind("click").click(function(){return $("#entries").empty(),getHeadlines(),!1}),load(),$(".ui-loader").remove();var s=$("#feedURL"),a=$([]).add(s),d=$(".validateTips");$("#dialog-form").dialog({autoOpen:!1,dialogClass:"dialog-nav-bar",draggable:!1,resizable:!1,position:[5,10],width:300,modal:!0,buttons:{Subscribe:function(){var e=!0;if(a.removeClass("ui-state-error"),d.addClass("hidden"),e=e&&t(s,"URL",5,1e3),e=e&&n(s,/^(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,"URL must be a valid URL. Make sure the URL is correct and re-submit"),e){var o=$("#catItems option:selected").val(),r=i(s.val().trim()),l=$("#feedsAvail option:selected").val();if(null==l){$("#feedURL").val(r);subscribe(r,o)}else{$("#feedURL").val(l);subscribe(l,o)}}},Cancel:function(){$(this).dialog("close")}},close:function(){a.val("").removeClass("ui-state-error")}}),$(document).bind("keydown","j",expandNextEntry),$(document).bind("keydown","k",expandPreviousEntry),$(document).bind("keydown","n",jumpNextEntry),$(document).bind("keydown","p",jumpPreviousEntry),$(document).bind("keydown","o",toggleCurrentEntryAsExpanded),$(document).bind("keydown","m",toggleCurrentEntryAsRead)});var keepUnread=new function(){var e="g2tt_keepUnread_ids";this.keepUnreadIdMap=void 0,this.hasId=function(e,i){return 1==t[i]},this.removeId=function(e){delete t()[e]},this.addId=function(e){t()[e]=!0,this.save()},this.clean=function(e){var i=t();if(e.length>0)for(var n in i)n|=0,$.inArray(n,e)<0&&this.removeId(n);this.save()};var t=function(){var t;if(null==this.keepUnreadIdMap&&(this.keepUnreadIdMap=[],void 0!==$.cookie(e)&&(t=$.cookie(e)),t&&t.length>0))for(var i=t.split(","),n=0;n<i.length;n++)this.keepUnreadIdMap[i[n]]=!0;return this.keepUnreadIdMap};this.removeFromArray=function(e){var i=t();for(var n in i){n|=0;var s=$.inArray(n,e);s>=0&&e.splice(s,1)}},this.save=function(){var i="",n=t();for(articleId in n)i.length>0&&(i+=","),i+=articleId;$.cookie(e,i)}};